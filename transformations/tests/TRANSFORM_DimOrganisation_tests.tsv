# design test artefact			
# ARTEFACT: TRANSFORM_DimOrganisation_tests			
# DESCRIPTION: Test each transformation rule			
SOURCE_SELECTION_CRITERIA	DESTINATION_SELECTION_CRITERIA	TEST	DESCRIPTION
REUSE_SQL	"FROM (SELECT Party.seq_party_id OrgId, Party.party_code OrgCode, Party.party_name OrgName, hrc.element_struct_code StructureName, hrc.parent_id ParentId, hrc.parent_element_struct_code ParentStructureName, MAX(CASE WHEN party.Meta_LatestUpdate_TaskExecutionInstanceId >= -2 OR hrc.Meta_LatestUpdate_TaskExecutionInstanceId >= -2 THEN 1 ELSE 0 END) AS Meta_HasChanged FROM [schema].Crm_party party INNER JOIN [schema].Crm_element_hierarchy hrc ON hrc.element_id = seq_party_id WHERE element_struct_code IN ('COMPANY') GROUP BY Party.seq_party_id, Party.party_code, Party.party_name, hrc.element_struct_code, hrc.parent_id, hrc.parent_element_struct_code) AS _Level3 INNER JOIN (SELECT Party.seq_party_id OrgId, Party.party_code OrgCode, Party.party_name OrgName, hrc.element_struct_code StructureName, hrc.parent_id ParentId, hrc.parent_element_struct_code ParentStructureName, MAX(CASE WHEN party.Meta_LatestUpdate_TaskExecutionInstanceId >= -2 OR hrc.Meta_LatestUpdate_TaskExecutionInstanceId >= -2 THEN 1 ELSE 0 END) AS Meta_HasChanged FROM [schema].Crm_party party INNER JOIN [schema].Crm_element_hierarchy hrc ON hrc.element_id = seq_party_id WHERE element_struct_code IN ('SALESGRP') GROUP BY Party.seq_party_id, Party.party_code, Party.party_name, hrc.element_struct_code, hrc.parent_id, hrc.parent_element_struct_code) AS _Level2 ON _Level2.ParentId = _Level3.OrgId INNER JOIN (SELECT Party.seq_party_id OrgId, Party.party_code OrgCode, Party.party_name OrgName, hrc.element_struct_code StructureName, hrc.parent_id ParentId, hrc.parent_element_struct_code ParentStructureName, MAX(CASE WHEN party.Meta_LatestUpdate_TaskExecutionInstanceId >= -2 OR hrc.Meta_LatestUpdate_TaskExecutionInstanceId >= -2 THEN 1 ELSE 0 END) AS Meta_HasChanged FROM [schema].Crm_party party INNER JOIN [schema].Crm_element_hierarchy hrc ON hrc.element_id = seq_party_id WHERE element_struct_code IN ('SALESDEPT') GROUP BY Party.seq_party_id, Party.party_code, Party.party_name, hrc.element_struct_code, hrc.parent_id, hrc.parent_element_struct_code ) AS _Level1 ON _Level1.ParentId = _Level2.OrgId WHERE (_Level1.Meta_HasChanged = 1 OR _Level2.Meta_HasChanged = 1 OR _Level3.Meta_HasChanged = 1)"		
[REUSE_SQL]		source.length.should.equal(destination.length)	row counts should match
