# design test artefact                      	                                   	                                                                     	
# ARTEFACT: TRANSFORM_DimPricePlan_Usage_tests      	                                   	                                                                     	
# DESCRIPTION: Test each transformation rule	                                   	                                                                     	
SOURCE_SELECTION_CRITERIA                   	DESTINATION_SELECTION_CRITERIA     	TEST                                                                 	DESCRIPTION
REUSE_SQL                                   	"FROM /* Staging */ [schema].utl_pp_simple_schedule LEFT JOIN (SELECT utl_pp_relationship.price_plan_id, utl_pp_relationship.pp_simple_sched_id, utl_pp_relationship.Meta_LatestUpdate_TaskExecutionInstanceId FROM /* Staging */ [schema].utl_pp_relationship WHERE utl_pp_relationship.pp_simple_sched_id IN (SELECT utl_pp_relationship.pp_simple_sched_id FROM /* Staging */ [schema].utl_pp_relationship GROUP BY utl_pp_relationship.pp_simple_sched_id HAVING COUNT (*) = 1)) AS _ppRelationship ON _ppRelationship.pp_simple_sched_id = utl_pp_simple_schedule.pp_simple_sched_id LEFT JOIN /* Staging */ [schema].utl_price_plan ON utl_price_plan.price_plan_id = _ppRelationship.price_plan_id LEFT JOIN (SELECT value_code.price_plan_code, value_code.variation_from_market, value_code.Meta_LatestUpdate_TaskExecutionInstanceId, ROW_NUMBER () OVER (PARTITION BY value_code.price_plan_code ORDER BY value_code.Meta_LatestUpdate_TaskExecutionInstanceId DESC) AS recency FROM /* Staging */ [schema].value_code) AS _value_code ON _value_code.price_plan_code = utl_price_plan.price_plan_code AND _value_code.recency = 1 WHERE utl_pp_simple_schedule.Meta_LatestUpdate_TaskExecutionInstanceId > -2 OR utl_price_plan.Meta_LatestUpdate_TaskExecutionInstanceId > -2 OR _value_code.Meta_LatestUpdate_TaskExecutionInstanceId > -2 OR _ppRelationship.Meta_LatestUpdate_TaskExecutionInstanceId > -2"	                                                                     	
[REUSE_SQL]                                 	                                   	source.length.should.equal(destination.length)                       	row counts should match
