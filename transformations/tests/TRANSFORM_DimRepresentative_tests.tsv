# design test artefact                      	                                   	                                                                     	
# ARTEFACT: TRANSFORM_DimVersion_tests      	                                   	                                                                     	
# DESCRIPTION: Test each transformation rule	                                   	                                                                     	
SOURCE_SELECTION_CRITERIA                   	DESTINATION_SELECTION_CRITERIA     	TEST                                                                 	DESCRIPTION
REUSE_SQL                                   	"FROM (SELECT crm_element_hierarchy.element_id, crm_element_hierarchy.element_struct_code, crm_element_hierarchy.parent_id, crm_element_hierarchy.parent_element_struct_code, crm_element_hierarchy.Meta_LatestUpdate_TaskExecutionInstanceId, row_number() OVER (PARTITION BY crm_element_hierarchy.element_id ORDER BY crm_element_hierarchy.start_date1 DESC) AS recency FROM /* Staging */ [schema].crm_element_hierarchy WHERE crm_element_hierarchy.element_struct_code IN ('SALES', 'STAFF')) AS _representative INNER JOIN [schema].crm_party ON crm_party.seq_party_id = _representative.element_id WHERE _representative.recency = 1 AND _representative.Meta_LatestUpdate_TaskExecutionInstanceId > -2"	                                                                     	
[REUSE_SQL]                                 	                                   	source.length.should.equal(destination.length)                       	row counts should match
[REUSE_SQL] AND element_id = 1234	WHERE RepresentativeKey = 1234	source[0].elementId.should.equal(destination[0].RepresentativeKey.trim())  	1:1 map rule
[REUSE_SQL] AND element_id = 1234	WHERE RepresentativeKey = 1234	source[0].first_name.should.equal(destination[0].FirstName.trim())	1:1 map rule
