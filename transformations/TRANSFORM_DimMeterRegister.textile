
h2. ARTEFACT: TRANSFORM_DimMeterRegister

DESCRIPTION: Promote meter registers from Orion tables to DataStore

|*SOURCE_FUNCTION_PREFIX*	|*SOURCE*	|*SOURCE_FUNCTION_SUFFIX*	|*DESTINATION*	|*DESCRIPTION*	|
|CAST(	|"utl_meter":../staging/utl_meter.textile .meter_id	|AS int)	|"DimMeterRegister":../datastore/DimMeterRegister.textile .MeterRegisterKey	|One to one mapping with int cast	|
|CAST(COALESCE(	|"utl_meter":../staging/utl_meter.textile _header.meter_serial	|", "utl_meter":../staging/utl_meter.textile .market_meter_code, "utl_meter":../staging/utl_meter.textile _header.meter_code, "utl_meter":../staging/utl_meter.textile .meter_code) AS nvarchar(50))"	|"DimMeterRegister":../datastore/DimMeterRegister.textile .MeterMarketSerialNumber	|One to one mapping with coalesce and nvarchar cast	|
|CAST(	|"utl_meter":../staging/utl_meter.textile .meter_code	|AS nvarchar(50))	|"DimMeterRegister":../datastore/DimMeterRegister.textile .MeterSystemSerialNumber	|One to one mapping with nvarchar cast	|
|CAST(CASE	|"utl_meter":../staging/utl_meter.textile _class.seq_product_type_id	|WHEN '1' THEN 'Internet' WHEN '2' THEN 'Electricity' WHEN '3' THEN 'Gas' WHEN '7' THEN 'Telco' ELSE NULL END AS nvarchar(11))	|"DimMeterRegister":../datastore/DimMeterRegister.textile .MeterServiceType	|Lookup with nvarchar cast	|
|CAST(	|"utl_meter":../staging/utl_meter.textile _type.meter_type_desc	|AS nvarchar(100))	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterBillingType	|One to one mapping	|
|CAST(	|"utl_meter":../staging/utl_meter.textile _type.meter_type_code	|AS nchar(10))	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterBillingTypeCode	|One to one mapping	|
|CAST(	|"utl_meter":../staging/utl_meter.textile _class.meter_class_desc	|AS nvarchar(40))	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterClass	|One to one mapping	|
|	|"utl_meter":../staging/utl_meter.textile .insert_datetime	|	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterCreationDate	|One to one mapping	|
|	|"utl_meter":../staging/utl_meter.textile .est_daily_consumption	|	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterEstimatedDailyConsumption	|One to one mapping	|
|CAST(COALESCE(	|"utl_meter":../staging/utl_meter.textile .market_meter_register	|", "utl_meter":../staging/utl_meter.textile .meter_register) AS nchar(10))"	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterMarketIdentifier	|One to one mapping	|
|CAST(	|"utl_meter":../staging/utl_meter.textile .meter_register	|AS nchar(10))	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterSystemIdentifer	|One to one mapping	|
|	|"utl_meter":../staging/utl_meter.textile .multiplier	|	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterMultiplier	|One to one mapping	|
|CAST(	|"utl_meter":../staging/utl_meter.textile .network_tariff_code	|AS nvarchar(20))	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterNetworkTariffCode	|One to one mapping	|
|CAST (CASE WHEN LEFT(	|"utl_meter":../staging/utl_meter.textile .market_meter_register	|",1) = 'B' THEN 'Import'WHEN LEFT("utl_meter":../staging/utl_meter.textile .market_meter_register,1) = 'K' THEN 'Import' WHEN utl_price_class.import = 'Y' THEN 'Import' ELSE 'Export' END AS nchar (6))"	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterReadDirection	|One to one mapping	|
|CAST(CASE	|"utl_meter":../staging/utl_meter.textile .meter_status_id	|WHEN 1 THEN 'Active' WHEN 2 THEN 'Inactive' ELSE NULL END AS nchar(8))	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterStatus	|One to one mapping	|
|	|"utl_meter":../staging/utl_meter.textile .vm_start_date	|	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterVirtualStartDate	|One to one mapping	|
|CAST(CASE WHEN	|"utl_virtual_meter_type":../staging/utl_virtual_meter_type.textile .virtual_meter_type_desc	|"IS NULL THEN 'Physical' ELSE CONCAT('Virtual - ', "utl_virtual_meter_type":../staging/utl_virtual_meter_type.textile .virtual_meter_type_desc) END AS nvarchar(20))"	|"DimMeterRegister":../datastore/DimMeterRegister.textile .RegisterVirtualType	|One to one mapping	|
|SELECTION_CRITERIA	|FROM [schema]."utl_meter":../staging/utl_meter.textile  LEFT JOIN [schema]."utl_meter":../staging/utl_meter.textile _header ON "utl_meter":../staging/utl_meter.textile _header.meter_header_id = "utl_meter":../staging/utl_meter.textile .meter_header_id INNER JOIN [schema]."utl_meter":../staging/utl_meter.textile _type ON "utl_meter":../staging/utl_meter.textile _type.meter_type_id = "utl_meter":../staging/utl_meter.textile .meter_type_id INNER JOIN [schema].utl_price_class ON utl_price_class.price_class_id = "utl_meter":../staging/utl_meter.textile _type.price_class_id INNER JOIN [schema]."utl_meter":../staging/utl_meter.textile _class ON "utl_meter":../staging/utl_meter.textile _class.meter_class_id = "utl_meter":../staging/utl_meter.textile _type.meter_class_id LEFT JOIN [schema]."utl_virtual_meter_type":../staging/utl_virtual_meter_type.textile  ON "utl_virtual_meter_type":../staging/utl_virtual_meter_type.textile .virtual_meter_type_id = "utl_meter":../staging/utl_meter.textile .virtual_meter_type_id  WHERE ("utl_meter":../staging/utl_meter.textile .Meta_LatestUpdate_TaskExecutionInstanceId > @LatestSuccessfulTaskExecutionInstanceID OR "utl_meter":../staging/utl_meter.textile _header.Meta_LatestUpdate_TaskExecutionInstanceId > @LatestSuccessfulTaskExecutionInstanceID OR "utl_meter":../staging/utl_meter.textile _type.Meta_LatestUpdate_TaskExecutionInstanceId > @LatestSuccessfulTaskExecutionInstanceID OR "utl_meter":../staging/utl_meter.textile _type.Meta_LatestUpdate_TaskExecutionInstanceId > @LatestSuccessfulTaskExecutionInstanceID OR "utl_virtual_meter_type":../staging/utl_virtual_meter_type.textile .Meta_LatestUpdate_TaskExecutionInstanceId > @LatestSuccessfulTaskExecutionInstanceID)|

