
h2. ARTEFACT: TRANSFORM_DimCustomer_Residential

DESCRIPTION: Promote residential customers from Orion tables to DataStore

|*SOURCE_FUNCTION_PREFIX*	|*SOURCE*	|*SOURCE_FUNCTION_SUFFIX*	|*DESTINATION*	|*DESCRIPTION*	|
|CASE WHEN ISNUMERIC ("crm_party":../staging/crm_party.textile .party_code) = 1 THEN CAST(	|"crm_party":../staging/crm_party.textile .party_code	|AS int) END	|"DimCustomer":../datastore/DimCustomer.textile .CustomerCode	|A	|
|CAST(	|"nc_client":../staging/nc_client.textile .seq_party_id	|AS int)	|"DimCustomer":../datastore/DimCustomer.textile .CustomerKey	|b	|
|CAST(	|"crm_party":../staging/crm_party.textile .title	|AS nchar(3))	|"DimCustomer":../datastore/DimCustomer.textile .Title	|c	|
|CAST(	|"crm_party":../staging/crm_party.textile .first_name	|AS nvarchar(100))	|"DimCustomer":../datastore/DimCustomer.textile .Firstname	|d	|
|CAST(	|"crm_party":../staging/crm_party.textile .initials	|AS nchar(10))	|"DimCustomer":../datastore/DimCustomer.textile .MiddleInitial	|e	|
|CAST(	|"crm_party":../staging/crm_party.textile .last_name	|AS nvarchar(100))	|"DimCustomer":../datastore/DimCustomer.textile .LastName	|f	|
|CAST(	|"crm_party":../staging/crm_party.textile .party_name	|AS nvarchar(100))	|"DimCustomer":../datastore/DimCustomer.textile .PartyName	|g	|
|CAST(	|"crm_party":../staging/crm_party.textile .postal_addr_1	|AS nvarchar(100))	|"DimCustomer":../datastore/DimCustomer.textile .PostalAddressLine1	|h	|
|CAST(	|"crm_party":../staging/crm_party.textile .postal_addr_2	|AS nvarchar(50))	|"DimCustomer":../datastore/DimCustomer.textile .PostalSuburb	|A	|
|CAST(	|"crm_party":../staging/crm_party.textile .postal_post_code	|AS nchar(4))	|"DimCustomer":../datastore/DimCustomer.textile .PostalPostcode	|b	|
|CAST(	|"crm_party":../staging/crm_party.textile .postal_addr_3	|AS nchar(3))	|"DimCustomer":../datastore/DimCustomer.textile .PostalState	|c	|
|CAST(	|"crm_party":../staging/crm_party.textile .street_addr_1	|AS nvarchar(100))	|"DimCustomer":../datastore/DimCustomer.textile .ResidentialAddressLine1	|d	|
|CAST(	|"crm_party":../staging/crm_party.textile .street_addr_2	|AS nvarchar(50))	|"DimCustomer":../datastore/DimCustomer.textile .ResidentialSuburb	|e	|
|CAST(	|"crm_party":../staging/crm_party.textile .street_post_code	|AS nchar(4))	|"DimCustomer":../datastore/DimCustomer.textile .ResidentialPostcode	|f	|
|CAST(	|"crm_party":../staging/crm_party.textile .street_addr_3	|AS nchar(3))	|"DimCustomer":../datastore/DimCustomer.textile .ResidentialState	|g	|
|CAST(CONCAT(	|"crm_party":../staging/crm_party.textile .std_code	|", "crm_party":../staging/crm_party.textile .phone_no) AS nvarchar(24))"	|"DimCustomer":../datastore/DimCustomer.textile .PrimaryPhone	|h	|
|CAST(CASE	|"crm_party":../staging/crm_party.textile .primary_phone_type_id	|WHEN '1' THEN 'Landline' WHEN '2' THEN 'Mobile' ELSE 'Unknown' END AS nchar(8))	|"DimCustomer":../datastore/DimCustomer.textile .PrimaryPhoneType	|A	|
|CAST(CONCAT(	|"crm_party":../staging/crm_party.textile .secondary_std_code	|", "crm_party":../staging/crm_party.textile .secondary_phone_no) AS nvarchar(24))"	|"DimCustomer":../datastore/DimCustomer.textile .SecondaryPhone	|b	|
|CAST(CASE	|"crm_party":../staging/crm_party.textile .secondary_phone_type_id	|WHEN '1' THEN 'Landline' WHEN '2' THEN 'Mobile' ELSE 'Unknown' END AS nchar(8))	|"DimCustomer":../datastore/DimCustomer.textile .SecondaryPhoneType	|c	|
|CAST(CASE WHEN LEFT(	|"crm_party":../staging/crm_party.textile .std_code	|",1) = '4' THEN CONCAT("crm_party":../staging/crm_party.textile .std_code, "crm_party":../staging/crm_party.textile .phone_no) WHEN LEFT("crm_party":../staging/crm_party.textile .secondary_std_code,1) = '4' THEN CONCAT("crm_party":../staging/crm_party.textile .secondary_std_code, "crm_party":../staging/crm_party.textile .secondary_phone_no) ELSE 'Unknown' END AS nchar(10))"	|"DimCustomer":../datastore/DimCustomer.textile .MobilePhone	|d	|
|CAST(	|"crm_party":../staging/crm_party.textile .email_address	|AS nvarchar(100))	|"DimCustomer":../datastore/DimCustomer.textile .Email	|e	|
|	|"crm_party":../staging/crm_party.textile .date_of_birth	|	|"DimCustomer":../datastore/DimCustomer.textile .DateOfBirth	|f	|
|CAST(CASE	|"crm_element_hierarchy":../staging/crm_element_hierarchy.textile .seq_element_type_id	|WHEN '9' THEN 'Residential' WHEN '8' THEN 'Business' ELSE 'Unknown' END AS nchar(11))	|"DimCustomer":../datastore/DimCustomer.textile .CustomerType	|g	|
|SELECTION_CRITERIA	|"FROM lumo."crm_party":../staging/crm_party.textile , lumo."nc_client":../staging/nc_client.textile , lumo."crm_element_hierarchy":../staging/crm_element_hierarchy.textile  WHERE "nc_client":../staging/nc_client.textile .seq_party_id = "crm_party":../staging/crm_party.textile .seq_party_id AND "crm_element_hierarchy":../staging/crm_element_hierarchy.textile .element_id = "crm_party":../staging/crm_party.textile .seq_party_id AND "crm_element_hierarchy":../staging/crm_element_hierarchy.textile .seq_element_type_id = '9'"|

