
h2. ARTEFACT: TRANSFORM_FactPricePlanRate_Usage_Gas

DESCRIPTION: Promote price plan rates from Orion tables to DataStore

|*SOURCE_FUNCTION_PREFIX*	|*SOURCE*	|*SOURCE_FUNCTION_SUFFIX*	|*DESTINATION*	|*DESCRIPTION*	|
|WITH_STATEMENTS	|"WITH applicablePricePlans AS (SELECT MAX (utl_pp_schedule.sched_id) AS sched_id, utl_pp_schedule.price_plan_id FROM /* Staging */ [schema].utl_pp_schedule WHERE utl_pp_schedule.sched_type_id = 12 GROUP BY utl_pp_schedule.price_plan_id)"	|	|	|Price plan temporary table price plans of each contract and product name temporary table provides the name of the product for each contract	|
|	|_DimPricePlan.PricePlanId	|	|"FactPricePlanRate":../datastore/FactPricePlanRate.textile .PricePlanId	|One to one mapping	|
|/*	|"utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile .sched_rate_id	|*/ -1	|"FactPricePlanRate":../datastore/FactPricePlanRate.textile .UnitTypeId	|One to one mapping	|
|N'USAGE.' + CAST (	|"utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile .sched_rate_id	|AS nvarchar(10)) + N'.G'	|"FactPricePlanRate":../datastore/FactPricePlanRate.textile .PricePlanRateKey	|One to one mapping	|
|"CONVERT (nchar (8) , COALESCE ("	|"utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile .start_date	|", '9999-12-31') , 112)"	|"FactPricePlanRate":../datastore/FactPricePlanRate.textile .RateStartDateId	|One to one mapping	|
|"CONVERT (nchar (8) , COALESCE ("	|"utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile .end_date	|", '9999-12-31') , 112)"	|"FactPricePlanRate":../datastore/FactPricePlanRate.textile .RateEndDateId	|One to one mapping	|
|COALESCE (	|"utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile .band_start	|", 0.00)"	|"FactPricePlanRate":../datastore/FactPricePlanRate.textile .StepStart	|One to one mapping	|
|COALESCE (	|"utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile .band_end	|", 999999999) "	|"FactPricePlanRate":../datastore/FactPricePlanRate.textile .StepEnd	|One to one mapping	|
|COALESCE (	|"utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile .unit_rate	|", 0.00)"	|"FactPricePlanRate":../datastore/FactPricePlanRate.textile .Rate	|One to one mapping	|
|COALESCE (	|"utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile .minimum_charge	|", 0.00)"	|"FactPricePlanRate":../datastore/FactPricePlanRate.textile .MinimumCharge	|One to one mapping	|
|CAST (	|"utl_pp_schedule_type":../staging/utl_pp_schedule_type.textile .sched_type_desc	|AS nvarchar (100))	|"FactPricePlanRate":../datastore/FactPricePlanRate.textile .RateType	|One to one mapping	|
|CAST (	|"utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile .invoice_desc	|AS nvarchar (100))	|"FactPricePlanRate":../datastore/FactPricePlanRate.textile .InvoiceDescription	|One to one mapping	|
|SELECTION_CRITERIA	|FROM /* Staging */ [schema].utl_pp_schedule INNER JOIN applicablePricePlans AS _applicablePricePlans ON _applicablePricePlans.sched_id = utl_pp_schedule.sched_id INNER JOIN /* Staging */ [schema]."utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile  ON "utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile .sched_id = utl_pp_schedule.sched_id INNER JOIN /* Dimensional */ [schema].DimPricePlan AS _DimPricePlan ON _DimPricePlan.PricePlanKey = N'USAGE.' + CAST ( utl_pp_schedule.price_plan_id AS nvarchar(10)) + N'.G' AND _DimPricePlan.Meta_IsCurrent = 1 INNER JOIN /* Dimensional */ [schema].DimUnitType AS _DimUnitType ON _DimUnitType.UnitTypeName = N'Days'AND _DimUnitType.Meta_IsCurrent = 1 INNER JOIN /* Staging */ [schema]."utl_pp_schedule_type":../staging/utl_pp_schedule_type.textile  ON "utl_pp_schedule_type":../staging/utl_pp_schedule_type.textile .sched_type_id = utl_pp_schedule.sched_type_id WHERE utl_pp_schedule.Meta_LatestUpdate_TaskExecutionInstanceId > @LatestSuccessfulTaskExecutionInstanceID OR "utl_pp_schedule_rate":../staging/utl_pp_schedule_rate.textile .Meta_LatestUpdate_TaskExecutionInstanceId > @LatestSuccessfulTaskExecutionInstanceID OR _DimPricePlan.Meta_LatestUpdate_TaskExecutionInstanceId > @LatestSuccessfulTaskExecutionInstanceID|

