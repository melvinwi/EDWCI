# design artefact				
# ARTEFACT: TRANSFORM_CUSTOMER				
# DESCRIPTION: Promote Customer from CRM and ACCOUNT systems to DataStore 				
SOURCE_FUNCTION_PREFIX	SOURCE	SOURCE_FUNCTION_SUFFIX	DESTINATION	DESCRIPTION
CAST(	crm_party.party_code	AS int)	DimCustomer.CustomerCode	A
CAST(	nc_client.seq_party_id	AS int)	DimCustomer.CustomerKey	b
CAST(ISNULL(	crm_party.title	",'') AS nchar(3))"	DimCustomer.Title	c
CAST(ISNULL(NULLIF(	crm_party.first_name	",''),'Unknown') AS nvarchar(100))"	DimCustomer.Firstname	d
CAST(ISNULL(	crm_party.initials	",'') AS nchar(10))"	DimCustomer.MiddleInitial	e
CAST(ISNULL(NULLIF(	crm_party.last_name	",''),'Unknown') AS nvarchar(100))"	DimCustomer.LastName	f
CAST(ISNULL(NULLIF(	crm_party.party_name	",''),'Unknown') AS nvarchar(100))"	DimCustomer.PartyName	g
CAST(ISNULL(NULLIF(	crm_party.postal_addr_1	",''),'Unknown') AS nvarchar(100))"	DimCustomer.PostalAddressLine1	h
CAST(ISNULL(NULLIF(	crm_party.postal_addr_2	",''),'Unknown') AS nvarchar(50))"	DimCustomer.PostalSuburb	A
CAST(ISNULL(NULLIF(	crm_party.postal_post_code	",''),'Unk') AS nchar(4))"	DimCustomer.PostalPostcode	b
CAST(ISNULL(NULLIF(	crm_party.postal_addr_3	",''),'Unk') AS nchar(3))"	DimCustomer.PostalState	c
CAST(ISNULL(NULLIF(	crm_party.street_addr_1	",''),'Unknown') AS nvarchar(100))"	DimCustomer.ResidentialAddressLine1	d
CAST(ISNULL(NULLIF(	crm_party.street_addr_2	",''),'Unknown') AS nvarchar(50))"	DimCustomer.ResidentialSuburb	e
CAST(ISNULL(NULLIF(	crm_party.street_post_code	",''),'Unk') AS nchar(4))"	DimCustomer.ResidentialPostcode	f
CAST(ISNULL(NULLIF(	crm_party.street_addr_3	",''),'Unk') AS nchar(3))"	DimCustomer.ResidentialState	g
CAST(ISNULL(NULLIF(CONCAT(	crm_party.std_code	", crm_party.phone_no),''),'Unknown') AS nvarchar(24))"	DimCustomer.PrimaryPhone	h
CAST(CASE WHEN 	crm_party.primary_phone_type_id	= '1' THEN 'Landline' WHEN crm_party.primary_phone_type_id = '2' THEN 'Mobile' ELSE 'Unknown' END AS nchar(8))	DimCustomer.PrimaryPhoneType	A
CAST(ISNULL(NULLIF(CONCAT(	crm_party.secondary_std_code	", crm_party.secondary_phone_no),''),'Unknown') AS nvarchar(24))"	DimCustomer.SecondaryPhone	b
CAST(CASE WHEN 	crm_party.secondary_phone_type_id	= '1' THEN 'Landline' WHEN crm_party.secondary_phone_type_id = '2' THEN 'Mobile' ELSE 'Unknown' END AS nchar(8))	DimCustomer.SecondaryPhoneType	c
CAST(CASE WHEN LEFT(	crm_party.std_code	",1) = '4' THEN CONCAT(crm_party.std_code, crm_party.phone_no) WHEN LEFT(crm_party.secondary_std_code,1) = '4' THEN CONCAT(crm_party.secondary_std_code, crm_party.secondary_phone_no) ELSE 'Unknown' END AS nvarchar(24))"	DimCustomer.MobilePhone	d
CAST(ISNULL(NULLIF(	crm_party.email_address	",''),'Unknown') AS nvarchar(100))"	DimCustomer.Email	e
	crm_party.date_of_birth		DimCustomer.DateOfBirth	f
CAST(CASE WHEN 	crm_element_hierarchy.seq_element_type_id	= '9' THEN 'Residential' WHEN crm_element_hierarchy.seq_element_type_id = '8' THEN 'Business' ELSE 'Unknown' END AS nchar(11))	DimCustomer.CustomerType	g
SELECTION_CRITERIA	FROM lumo.nc_client, lumo.crm_party, lumo.crm_element_hierarchy WHERE nc_client.seq_party_id = crm_party.seq_party_id AND crm_element_hierarchy.element_id = crm_party.seq_party_id			
